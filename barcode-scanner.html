<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>条形码识别工具（上传图片版）</title>
    <!-- 引入ZXing库 -->
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.21.1/dist/zxing.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { padding: 2rem 1rem; background: #f5f5f5; text-align: center; }
        h1 { font-size: 1.8rem; color: #333; margin-bottom: 2rem; }
        
        .upload-box {
            width: 90%;
            max-width: 500px;
            margin: 0 auto 2rem;
            padding: 3rem 1rem;
            border: 2px dashed #2c7be5;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        .upload-box:hover { border-color: #1a68d1; }
        .upload-box i { font-size: 3rem; color: #2c7be5; margin-bottom: 1rem; }
        .upload-text { font-size: 1rem; color: #666; }
        #file-input { display: none; }

        #preview {
            width: 90%;
            max-width: 500px;
            height: 200px;
            margin: 0 auto 2rem;
            border-radius: 8px;
            overflow: hidden;
            display: none;
        }
        #preview img { width: 100%; height: 100%; object-fit: contain; }

        #result {
            width: 90%;
            max-width: 500px;
            margin: 0 auto;
            padding: 1.5rem;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #eee;
            font-size: 1.2rem;
            color: #333;
            min-height: 60px;
            word-break: break-all;
        }

        .tip {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #999;
        }
    </style>
</head>
<body>
    <h1>条形码识别工具</h1>

    <!-- 上传区域 -->
    <label class="upload-box" for="file-input">
        <div class="upload-text">点击上传条形码照片</div>
        <div class="upload-text">或拍照后选择图片</div>
    </label>
    <input type="file" id="file-input" accept="image/*" capture="environment">

    <!-- 图片预览 -->
    <div id="preview"><img id="preview-img" src="" alt="预览"></div>

    <!-- 识别结果 -->
    <div id="result">等待上传图片...</div>
    <div class="tip">提示：请拍摄清晰的条形码，避免反光和倾斜</div>

    <script>
        // 初始化ZXing阅读器
        const codeReader = new ZXing.BrowserMultiFormatReader();
        const fileInput = document.getElementById('file-input');
        const preview = document.getElementById('preview');
        const previewImg = document.getElementById('preview-img');
        const resultEl = document.getElementById('result');

        // 监听文件选择
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // 1. 显示图片预览
            const imgUrl = URL.createObjectURL(file);
            previewImg.src = imgUrl;
            preview.style.display = 'block';
            resultEl.textContent = "正在识别条形码...";
            resultEl.style.color = "#333";

            try {
                // 2. 识别图片中的条形码
                const result = await codeReader.decodeFromImageElement(previewImg);
                // 识别成功
                resultEl.textContent = `识别成功：${result.text}`;
                resultEl.style.color = "#28a745";
            } catch (err) {
                // 识别失败
                resultEl.textContent = `识别失败：${err.message}，请拍摄更清晰的条形码`;
                resultEl.style.color = "#e53e3e";
            }
        });

        // 支持拍照直接上传（手机端）
        fileInput.capture = 'environment'; // 优先调用后置摄像头拍照
    </script>
</body>
</html>
